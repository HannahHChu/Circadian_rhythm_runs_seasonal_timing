---
title: "Calculating Metabolic Rate"
output: html_document
---
### Library

```{r lib}
library(ggplot2)
library(lubridate)
```

```{r }
t<-hm(c("13:16","16:12"))
time.x = hour(t) + minute(t)/60

d<-seq(time.x[1],time.x[2],length.out=154)

d
###for whole dataset 
x<-read.csv("../Data/2017-10-27_data_slice.csv")

#day 10 resp
##purge
x$purge_time_1<-hm(x$purge_time_1)
x$purge1<-hour(x$purge_time_1) + minute(x$purge_time_1)/60
###resp time
x$resp_time1<-hms(x$resp_time_1)
x$resp1<-hour(x$resp_time1) + minute(x$resp_time1)/60

###purge time
# check the number of samples per collection date , cohort day, and tape
ddply(x,.(collection_date,cohort_day,tape),summarize,counts=length(tape))
#new.x<-ddply(x,.(collection_date,cohort_day,tape),transform,ftime=seq(from=min(purge1,na.rm=TRUE),to=max(purge1,na.rm=TRUE),length.out=length(tape)))
#new.x<-ddply(x,.(collection_date,cohort_day,tape),transform,fulltime=24-seq(from=min(purge1,na.rm=TRUE),to=max(purge1,na.rm=TRUE),length.out=length(tape))+resp1)
new.x<-ddply(x,.(collection_date,cohort_day,tape),transform,MR=resp_day11/(24-seq(from=min(purge1,na.rm=TRUE),to=max(purge1,na.rm=TRUE),length.out=length(tape))+resp1))
head(new.x)

#new.x$Blank<-
blank.dat<-ddply(subset(new.x,Site_name=="Blank"),.(collection_date,cohort_day,tape,Site_name),summarize,Blank.mean=mean(MR))[,-4]

#library(dplyr)
new.x2<-left_join(new.x,blank.dat,by=c("collection_date","cohort_day","tape"))
dim(new.x2)
new.x2$MSMR<-(new.x2$MR-new.x2$Blank.mean)/new.x2$mass_day10

new.x3<-subset(new.x2,Site_name!="Blank"& MSMR >0)
#dim(subset(new.x3,MSMR<0))

ggplot(new.x3,aes(y=MSMR,x=Host))+geom_boxplot()

ggplot(new.x3,aes(y=MSMR,x=cohort_day,colour=Host))+geom_point()

ggplot(new.x3,aes(y=eclosion_days,x=MSMR,colour=Host))+geom_point()+xlim(0,0.015)

ggplot(new.x3,aes(y=eclosion_days,x=MR,colour=Host))+geom_point()
#write.csv(new.x,"2017-10-27_data_slice_.csv")
###resp time
#ddply(x,.(collection_date,cohort_day,tape),summarize,counts=length(tape),min=min(resp1,na.rm=TRUE))

#new.x2<-ddply(x,.(collection_date,cohort_day,tape),transform,ftime2=seq(from=min(resp1,na.rm=TRUE),to=max(resp1,na.rm=TRUE),length.out=length(tape)))
#fulltime=(24-ftime)+ftime2
#head(new.x)


```


### Session Info
```{r sessioninfo}
sessionInfo()
```

