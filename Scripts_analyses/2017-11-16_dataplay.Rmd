---
title: "calculating mass specific metabolic rate"
output: 
  html_document: 
    toc: yes
---

# Goal: calculate and visualize mass specific metabolic rate  

resp(mL)/time(hr)/mass(mg) =mass specific metabolic rate 


Then we want to compare it between apples and hawthornes   

reading in the data   

```{r}
library(lubridate)
dat<-read.csv("../Data/2017-08-24_rhagoletis_data_sheet_2017-11-26_dataslice.csv")
str(dat)

#
```


## Calculate total time 

### convert time (house:minutes:seconds) to units of hours 

### total time = (24-initial)+ respiormetry_time 
### day 11
```{r}
####creating a sequence for the purge times
dat$purge1_conv<-hour(hm(dat$purge_time_1))+minute(hm(dat$purge_time_1))/60
library(plyr)
ddply(dat,.(collection_date,cohort_day,tape),summarize,sample_sample=length(tape))

#seq(from=min(dat$purge1_conv,na.rm=TRUE),to=max(dat$purge1_conv,na.rm=TRUE),length.out=length(dat$tape))
dat2<-ddply(dat,.(collection_date,cohort_day,tape),transform,purge1_seq=seq(from=min(purge1_conv,na.rm=TRUE),to=max(purge1_conv,na.rm=TRUE),length.out=length(tape)))
dim(dat2)

###for the resp times, we just need to convert to hours 
dat2$resp1_seq<-hour(hms(dat$resp_time_1))+minute(hms(dat$resp_time_1))/60

dat2$total_time<-(24-dat2$purge1_seq)+dat2$resp1_seq
```

## day 15
```{r}
dat$purge2_conv<-hour(hm(dat$purge_time_2))+minute(hm(dat$purge_time_2))/60
ddply(dat,.(collection_date,cohort_day,tape),summarize,sample_sample=length(tape))

dat2<-ddply(dat,.(collection_date,cohort_day,tape),transform,purge2_seq=seq(from=min(purge2_conv,na.rm=TRUE),to=max(purge2_conv,na.rm=TRUE),length.out=length(tape)))
dim(dat2)

dat2$resp2_seq<-hour(hms(dat$resp_time_2))+minute(hms(dat$resp_time_2))/60

dat2$total_time<-(24-dat2$purge2_seq)+dat2$resp2_seq
##removing blanks##
blank.dat<-subset(dat2,Site_name=="Blank")

blank<-ddply(blank.dat,.(collection_date,cohort_day,tape),summarize,blank=mean(resp_day15,na.rm=TRUE))

dat3<-left_join(dat2,blank,by=c("collection_date","cohort_day","tape"))
dim(dat3)

dat3$resp2_sub<-dat3$resp_day15-dat3$blank
head(cbind(dat3$resp_day15,dat3$resp2_sub,dat3$blank))

dat3$resp2_sub<-dat3$resp_day15-dat3$blank
head(cbind(dat3$resp_day15,dat3$resp2_sub,dat3$blank))

dat3$MSMR<-dat3$resp2_sub/dat3$total_time/dat3$mass_day14

dat4<-subset(dat3,Site_name!="Blank")
```


## Subtract out blanks from each sample for every collection date, cohort day, and tape color  

```{r}
blank.dat<-subset(dat2,Site_name=="Blank")

blank<-ddply(blank.dat,.(collection_date,cohort_day,tape),summarize,blank=mean(resp_day11,na.rm=TRUE))

library(dplyr)

dat3<-left_join(dat2,blank,by=c("collection_date","cohort_day","tape"))
dim(dat3)

dat3$resp1_sub<-dat3$resp_day11-dat3$blank
head(cbind(dat3$resp_day11,dat3$resp2_sub,dat3$blank))

dat3$MSMR<-dat3$resp1_sub/dat3$total_time/dat3$mass_day10

dat4<-subset(dat3,Site_name!="Blank")
```


## Actually doing the caluclation : 

```{r}
dat3$MSMR<-dat3$resp1_sub/dat3$total_time/dat3$mass_day10

dat4<-subset(dat3,Site_name!="Blank")


```

# Visualize MSMR    

```{r}
ggplot(dat4,aes(x=Host,y=MSMR))+geom_boxplot()

ggplot(dat4,aes(x=MSMR,y=eclosion_days,colour=Host))+geom_point()+stat_smooth()


ggplot(dat4,aes(x=eclosion_days,fill=Host))+geom_histogram(alpha=.5)

ggplot(dat4,aes(x=eclosion_days,fill=Host))+geom_density(alpha=.5)


```



# Statistical analyses   





#### messing with time intervals   

```{r}

t<-interval("2017-11-01 00:01:00","2017-11-13 23:00:00", tzone = tz(start))
t

s<-seq(as.Date("2017-09-01"),by="days",length.out=100)
s

x<-read.table("Monitor6.txt")
x$V3<-match(x$V3,month.abb)


head(x)
time<-paste(paste("20",x$V4,"-",x$V3,"-",x$V2,sep=""),x$V5)

test<-data.frame(time=strptime(time,"%Y-%m-%d %H:%M:%S",tz=tz(start)))
test


head(subset(test,time %within% t))

test[test$time %within% t,]
```

